let votacionAbierta = false;

function toggleVotingButtons(enable) {
    const votarButtons = document.querySelectorAll('.votar');
    if (votarButtons) {
        votarButtons.forEach(button => {
            button.disabled = !enable;
        });
    }
}

// Manejar actualizaciones de recuento de votos en tiempo real
socket.on('recuento_votos', data => {
    votacionAbierta = true;
    actualizarRecuentoVotos(data.recuento_votos);
    toggleVotingButtons(true); // Habilitar botones de votar para todos los usuarios
});

// Manejar mensajes de votación cerrada en tiempo real
socket.on('votacion_cerrada', data => {
    votacionAbierta = false;
    toggleVotingButtons(false); // Deshabilitar botones de votar para todos los usuarios
    const resultadoVotacionDiv = document.getElementById('resultadoVotacion');
    if (resultadoVotacionDiv) {
        resultadoVotacionDiv.innerText = data.resultado;
        resultadoVotacionDiv.style.display = 'block';
    }
    // Actualizar otros elementos de la interfaz de usuario según sea necesario
});

// Manejar evento de votaciones reiniciadas
socket.on('votaciones_reiniciadas', () => {
    votacionAbierta = false;
    toggleVotingButtons(false); // Deshabilitar botones de votar para todos los usuarios
    const resultadoVotacionDiv = document.getElementById('resultadoVotacion');
    if (resultadoVotacionDiv) {
        resultadoVotacionDiv.style.display = 'none';
    }
    const recuentoVotosDiv = document.getElementById('recuentoVotos');
    if (recuentoVotosDiv) {
        recuentoVotosDiv.style.display = 'none';
        recuentoVotosDiv.innerHTML = ''; // Limpiar el recuento de votos
    }
});

// Función para manejar el clic en el botón de votar
function handleVoting(event) {
    const grupoId = parseInt(event.target.getAttribute('data-grupo')); // Convertir a entero
    fetch('/votar', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 'grupo': grupoId })
    })
    .then(response => response.json())
    .then(data => {
        console.log(data.resultado);
        // Aquí puedes actualizar la interfaz de usuario con el resultado
    })
    .catch(error => console.error('Error:', error));
}

// Añadir el evento de clic a cada botón de votar
const votarButtons = document.querySelectorAll('.votar');
if (votarButtons) {
    votarButtons.forEach(button => {
        button.addEventListener('click', handleVoting);
    });
}